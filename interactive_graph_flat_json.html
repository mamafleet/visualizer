
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Legal Topic Similarity Graph</title>
  <style>
    body { margin: 0; overflow: hidden; background: #1e1e1e; }
    #filter { position: absolute; top: 10px; left: 10px; z-index: 10; background: white; padding: 10px; border-radius: 5px; max-height: 90vh; overflow-y: auto; }
    label { display: block; margin-bottom: 5px; font-family: sans-serif; font-size: 14px; }
  </style>
</head>
<body>
  <div id="filter"><strong>Filter by Topic:</strong></div>
  <script src="https://cdn.jsdelivr.net/npm/3d-force-graph"></script>
  <script>
    const Graph = ForceGraph3D()
      (document.body)
      .backgroundColor('#1e1e1e')
      .nodeLabel('label')
      .nodeAutoColorBy('group')
      .nodeColor(() => '#ffcc00')  // Bright yellow nodes
      .linkOpacity(0.8)
      .linkColor(link => colorByCategory(link.category))
      .linkDirectionalParticles(2)
      .linkDirectionalParticleWidth(d => Math.max(d.value * 10, 1));

    let rawData = null;
    const categoryColors = {};
    const colorPalette = ["#00ffff", "#ff00ff", "#00ff00", "#ff9900", "#ff3333", "#cc00ff", "#33ccff", "#ffff00"];

    fetch('https://mamafleet.github.io/visualizer/flat_category_graph.json')
      .then(res => res.json())
      .then(data => {
        rawData = data;

        // Extract unique categories
        const allCategories = [...new Set(data.links.map(l => l.category))];
        allCategories.forEach((cat, i) => categoryColors[cat] = colorPalette[i % colorPalette.length]);

        const filterDiv = document.getElementById("filter");
        allCategories.forEach(cat => {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = cat;
          checkbox.checked = true;

          checkbox.addEventListener("change", () => {
            updateGraph();
          });

          const label = document.createElement("label");
          label.htmlFor = cat;
          label.innerText = cat;

          filterDiv.appendChild(checkbox);
          filterDiv.appendChild(label);
        });

        updateGraph();
      });

    function colorByCategory(cat) {
      return categoryColors[cat] || "#999";
    }

    function updateGraph() {
      if (!rawData) return;

      const activeCategories = Object.keys(categoryColors).filter(cat => {
        const box = document.getElementById(cat);
        return box && box.checked;
      });

      const filteredLinks = rawData.links.filter(link => activeCategories.includes(link.category));

      Graph.graphData({
        nodes: rawData.nodes,
        links: filteredLinks
      });

      Graph.cameraPosition({ z: 500 });
    }
  </script>
</body>
</html>
