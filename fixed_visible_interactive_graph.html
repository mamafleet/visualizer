
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Legal Topic Similarity Graph</title>
  <style>
    body { margin: 0; overflow: hidden; background: #1e1e1e; }
    #filter { position: absolute; top: 10px; left: 10px; z-index: 10; background: white; padding: 10px; border-radius: 5px; max-height: 90vh; overflow-y: auto; }
    label { display: block; margin-bottom: 5px; font-family: sans-serif; font-size: 14px; }
  </style>
</head>
<body>
  <div id="filter"><strong>Filter by Topic:</strong></div>
  <script src="https://cdn.jsdelivr.net/npm/3d-force-graph"></script>
  <script>
    const Graph = ForceGraph3D()
      (document.body)
      .backgroundColor('#1e1e1e')
      .nodeLabel('label')
      .nodeAutoColorBy('group')
      .nodeColor(() => '#ffcc00')  // Bright yellow nodes
      .linkOpacity(0.8)
      .linkColor(() => '#00ffff')  // Bright cyan links
      .linkDirectionalParticles(2)
      .linkDirectionalParticleWidth(d => Math.max(d.value * 10, 1));

    let rawData = null;

    fetch('https://mamafleet.github.io/visualizer/category_graph_multilinks.json')
      .then(res => res.json())
      .then(data => {
        rawData = data;
        const filterDiv = document.getElementById("filter");

        data.categories.forEach(cat => {
          const checkbox = document.createElement("input");
          checkbox.type = "checkbox";
          checkbox.id = cat;
          checkbox.checked = true;

          checkbox.addEventListener("change", () => {
            updateGraph();
          });

          const label = document.createElement("label");
          label.htmlFor = cat;
          label.innerText = cat;

          filterDiv.appendChild(checkbox);
          filterDiv.appendChild(label);
        });

        updateGraph();
      });

    function updateGraph() {
      if (!rawData) return;

      const activeCategories = rawData.categories.filter(cat => {
        const box = document.getElementById(cat);
        return box && box.checked;
      });

      let links = [];
      activeCategories.forEach(cat => {
        const catLinks = rawData.links_by_category[cat];
        if (Array.isArray(catLinks)) {
          links = links.concat(catLinks);
        }
      });

      Graph.graphData({
        nodes: rawData.nodes,
        links: links
      });

      // Set initial camera position back to reveal more space
      Graph.cameraPosition({ z: 500 });
    }
  </script>
</body>
</html>
